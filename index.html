<!DOCTYPE html>
<html ng-app="vidamo" xmlns="http://www.w3.org/1999/html">

<head>
  <meta charset="utf-8" />
  <title>Vidamo</title>

    <!-- stylesheet -->
    <link rel="stylesheet" href="css/vidamo-layout.css">
    <link rel="stylesheet" href="css/ui-layout.css">
    <link rel="stylesheet" href="css/bootstrap/bootstrap.css">
    <link rel="stylesheet" href="css/select2.css">
    <link rel="stylesheet" href="css/ui-tree.css">
    <link rel="stylesheet" href="css/graph.css">
    <link rel="stylesheet" href="css/panzoomwidget.css">

    <!--three.js-->
    <link id="theme" href="css/light.css" rel="stylesheet" />
    <link href="js/threejs/editor/css/types.css" rel="stylesheet">

    <script src="js/threejs/build/three.min.js"></script>
    <script src="js/threejs/examples/js/libs/system.min.js"></script>
    <script src="js/threejs/examples/js/controls/EditorControls.js"></script>
    <script src="js/threejs/examples/js/controls/TransformControls.js"></script>
    <script src="js/threejs/examples/js/loaders/BabylonLoader.js"></script>
    <script src="js/threejs/examples/js/loaders/ColladaLoader.js"></script>
    <script src="js/threejs/examples/js/loaders/OBJLoader.js"></script>
    <script src="js/threejs/examples/js/loaders/PLYLoader.js"></script>
    <script src="js/threejs/examples/js/loaders/STLLoader.js"></script>
    <script src="js/threejs/examples/js/loaders/UTF8Loader.js"></script>
    <script src="js/threejs/examples/js/loaders/VRMLLoader.js"></script>
    <script src="js/threejs/examples/js/loaders/VTKLoader.js"></script>
    <script src="js/threejs/examples/js/loaders/ctm/lzma.js"></script>
    <script src="js/threejs/examples/js/loaders/ctm/ctm.js"></script>
    <script src="js/threejs/examples/js/loaders/ctm/CTMLoader.js"></script>
    <script src="js/threejs/examples/js/exporters/SceneExporter.js"></script>
    <script src="js/threejs/examples/js/exporters/OBJExporter.js"></script>
    <script src="js/threejs/examples/js/exporters/STLExporter.js"></script>
    <script src="js/threejs/examples/js/renderers/RaytracingRenderer.js"></script>
    <script src="js/threejs/examples/js/renderers/SoftwareRenderer.js"></script>
    <script src="js/threejs/examples/js/renderers/SVGRenderer.js"></script>

    <script src="js/threejs/examples/js/BufferGeometryUtils.js"></script>
    <script src="js/threejs/examples/js/exporters/BufferGeometryExporter.js"></script>
    <script src="js/threejs/examples/js/exporters/TypedGeometryExporter.js"></script>
    <script src="js/threejs/examples/js/exporters/GeometryExporter.js"></script>
    <script src="js/threejs/examples/js/exporters/MaterialExporter.js"></script>
    <script src="js/threejs/examples/js/exporters/ObjectExporter.js"></script>
    <script src="js/threejs/examples/js/renderers/WebGLRenderer3.js"></script>

    <script src="js/threejs/editor/js/libs/signals.min.js"></script>
    <script src="js/threejs/editor/js/libs/ui.js"></script>
    <script src="js/threejs/editor/js/libs/ui.editor.js"></script>
    <script src="js/threejs/editor/js/libs/ui.three.js"></script>

    <script src="js/threejs/editor/js/Storage.js"></script>
    <script src="js/threejs/editor/js/Editor.js"></script>
    <script src="js/threejs/editor/js/Config.js"></script>
    <script src="js/threejs/editor/js/Loader.js"></script>
    <script src="js/threejs/editor/js/Viewport.js"></script>

    <script src="js/threejs/add.js"></script>

</head>

<body>
        <div  ng-controller="graphCtrl">

            <!--dropdown Menu-->
            <div class = "menubar">
                <span class="dropdown" on-toggle="toggled(open)">
                  <a href class="dropdown-toggle">  File |</a>
                  <ul class="dropdown-menu">
                      <li>
                          <a onclick="onNewOptionClick ()"> New </a>
                      </li>

                      <li>
                          <input type="file" id="importGraphJson" name="importGraphJson[]"
                                 style="visibility: hidden; width: 1px; height: 1px" multiple />
                          <a href="" ng-click="importGraphJson()">Import Graph</a>
                      </li>

                      <li>
                          <input type="file" id="importProcedureJson" name="importProcedureJson[]"
                                 style="visibility: hidden; width: 1px; height: 1px" multiple />
                          <a href="" ng-click="importProcedureJson()">Import Procedure</a>
                      </li>

                      <li id = "jsonurl">
                          <a ng-href="{{graphUrl}}" download="graph.json" ng-click = "exportGraphJson()"> Export Graph </a>
                      </li>

                      <li id = "jsonurl1">
                          <a ng-href="{{procedureUrl}}" download="procedure.json" ng-click = "exportProcedureJson()"> Export Procedure </a>
                      </li>

                      <li id = "jsonurl2">
                          <a ng-href="{{jsUrl}}" download="project.js" ng-click = "downloadJs()"> download JS file </a>
                      </li>

                  </ul>
                </span>

                <span class="dropdown" on-toggle="toggled(open)" >
                  <a href class="dropdown-toggle">  Edit |</a>
                </span>

                <span class="dropdown" on-toggle="toggled(open)" >
                  <a href class="dropdown-toggle">  View |</a>
                </span>

                <span class="dropdown" on-toggle="toggled(open)" >
                  <a href class="dropdown-toggle">  Libraries |</a>
                </span>

                <span class="dropdown" on-toggle="toggled(open)" >
                  <a href class="dropdown-toggle">  Setting |</a>
                </span>

                <span class="dropdown" on-toggle="toggled(open)" >
                  <a href class="dropdown-toggle">  Help |</a>
                </span>
            </div>

            <!--resizable layout-->
            <div ui-layout>
                <div ui-layout="{flow : 'column'}" >
                    <!--graph area-->
                    <div class=" graph-area">
                        <div
                             mouse-capture
                             ng-keydown="keyDown($event)"
                             ng-keyup="keyUp($event)">

                            <div ng-controller="znpController" class="znpController">
                                <div>
                                    <panzoom config="panzoomConfig"
                                             model="panzoomModel"
                                             class="panzoom">
                                        <div>
                                            <flow-chart chart="chartViewModel" class = "flow-chart" >
                                            </flow-chart>
                                        </div>
                                    </panzoom>
                                </div>
                            </div>

                            <div class = "buttons">
                                <button class="btn btn-default btn-xs"
                                        ng-click="addNewNode()"
                                        title="Add a new node to the chart">
                                    Add Node
                                </button> &nbsp;&nbsp;
                                <button class="btn btn-default btn-xs"
                                        ng-click="addNewInputConnector()"
                                        ng-disabled="chartViewModel.getSelectedNodes().length == 0"
                                        title="Add a new input connector to the selected node">
                                    Add Input
                                </button> &nbsp;&nbsp;
                                <button class="btn btn-default btn-xs"
                                        ng-click="addNewOutputConnector()"
                                        ng-disabled="chartViewModel.getSelectedNodes().length == 0"
                                        title="Add a new output connector to the selected node">
                                    Add Output
                                </button> &nbsp;&nbsp;
                                <button class="btn btn-default btn-xs"
                                        ng-click="deleteSelected()"
                                        ng-disabled="chartViewModel.getSelectedNodes().length
                                            == 0 && chartViewModel.getSelectedConnections().length == 0"
                                        title="Delete selected nodes and connections">
                                    Delete
                                </button> &nbsp;&nbsp;
                                <button class="btn btn-default btn-xs"
                                        ng-click="run()"
                                        title="Run program">
                                    Run
                                </button>
                            </div>
                        </div>
                    </div>

                <!--3D view area  -->
                    <div class=" view-area" >
                        <!--threejs editor view port-->
                        <div id="3dviewport" >
                        </div>

                        <!--console-->
                        <div class = "console" style="left:9px">
                            <button class="btn btn-default btn-xs" ng-click="isCollapsed = !isCollapsed" >
                                Console
                            </button>

                            <button class="btn btn-default btn-xs" ng-click="codeToggle = !codeToggle" >
                                Execution Code
                            </button>

                            <div collapse="isCollapsed">
                                <div class="well well-lg">
                                    <p>VIDAMO Console:</p>
                                    <div id = 'log'>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div ng-show="codeToggle">
                            <div class="codeEditor"
                                    ui-ace="{ mode: 'javascript', theme: 'monokai' }"
                                    ng-model="javascriptCode">
                            </div>

                            <svg width="32" height="32"
                                 style="position: absolute;
                                        top: 3px;
                                        right: 1px;
                                        cursor: pointer;">

                                <path d="M 12,12 L 22,22 M 22,12 12,22"
                                      stroke="#fff"
                                      stroke-width = '3'
                                      ng-click="codeToggle = !codeToggle">
                                </path>

                            </svg>
                        </div>

                    </div>


                <!--code area-->
                <div class="code-area" >
                    <div ng-if = "currentNodeName != ''">
                        <pre class="nodeName">{{currentNodeName}}</pre>
                    </div>

                    <tabset justified="true" class="tabArea">
                        <tab heading="Procedure" >
                            <div>
                                <div>
                                    <script type="text/ng-template" id="nodes_renderer_procedure.html">
                                        <div ui-tree-handle class="tree-node tree-node-content">
                                            <accordion>
                                                    <accordion-group is-open="true">
                                                        <accordion-heading>
                                                            <a ng-if="node.nodes && node.nodes.length > 0
                                                            || node.nodes && node.nodes.length == 0"
                                                               data-nodrag ng-click="toggle(this)">
                                                                  <i class="glyphicon"
                                                                        ng-class=
                                                                                "{'glyphicon-chevron-right': collapsed,
                                                                                 'glyphicon-chevron-down': !collapsed}">
                                                                  </i>
                                                            </a>
                                                            {{node.title}}
                                                            <a class="pull-right btn btn-xs"
                                                               data-nodrag ng-click="remove(this)">
                                                                <span class="glyphicon glyphicon-remove">
                                                                </span>
                                                            </a>
                                                        </accordion-heading>

                                                        <div ui-tree-nodes=""
                                                             ng-model="node.nodes"
                                                             ng-class="{hidden: collapsed}">

                                                            <!--data name and value for data -->
                                                            <div ng-if="node.title == 'Data'">
                                                                <div class="input-group input-group-sm">
                                                                    <span class="input-group-addon"> Data Type: </span>
                                                                    <select ng-model="dataType"
                                                                            name ="dataType"
                                                                            class="form-control"
                                                                            ng-change="applyValue('dataType',this.dataType,node)">
                                                                        <option value="" selected disabled>
                                                                            {{node.dataType}}
                                                                        </option>
                                                                        <option value="var">var</option>
                                                                        <option value="list">list</option>
                                                                    </select>
                                                                </div>

                                                                <div ng-if="node.dataType == 'var'">
                                                                    <div class="input-group input-group-sm">
                                                                        <span class="input-group-addon">var name</span>
                                                                        <input class="form-control"
                                                                               name="dataName"
                                                                               placeholder="{{node.dataName}}"
                                                                               ng-model="dataName"
                                                                               ng-change=
                                                                                   "applyValue('dataName',this.dataName,node)">
                                                                    </div>

                                                                    <div class="input-group input-group-sm">
                                                                        <span class="input-group-addon" >var value</span>
                                                                        <input class="form-control"
                                                                               name="dataValue"
                                                                               placeholder="{{node.dataValue}}"
                                                                               ng-model="dataValue"
                                                                               ng-change=
                                                                                   "applyValue('dataValue',this.dataValue,node)">
                                                                    </div>
                                                                </div>

                                                                <div ng-if="node.dataType == 'list'">
                                                                    <div class="input-group input-group-sm">
                                                                        <span class="input-group-addon">list name</span>
                                                                        <input class="form-control"
                                                                               name="dataName"
                                                                               placeholder="{{node.dataName}}"
                                                                               ng-model="dataName"
                                                                               ng-change=
                                                                                       "applyValue('dataName',this.dataName,node)">
                                                                    </div>

                                                                    <div class="input-group input-group-sm">
                                                                        <span class="input-group-addon" >list value</span>
                                                                        <input class="form-control"
                                                                               name="dataValue"
                                                                               placeholder="{{node.dataValue}}"
                                                                               ng-model="dataValue"
                                                                               ng-change=
                                                                                       "applyValue('dataValue',this.dataValue,node)">
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <!-- looping for Control-->
                                                            <div ng-if="node.title == 'Control'">
                                                                <div class="input-group input-group-sm">
                                                                    <span class="input-group-addon"> Control Type: </span>
                                                                    <select ng-model="controlType"
                                                                            class="form-control"
                                                                            name ="controlType"
                                                                            ng-change="applyValue('controlType',this.controlType,node)"
                                                                            >
                                                                        <option value="" selected disabled>
                                                                            {{node.controlType}}
                                                                        </option>
                                                                        <option value="for item in list">For item in list</option>
                                                                        <option value="while condition">while condition</option>
                                                                    </select>
                                                                </div>

                                                                <div ng-if="node.controlType == 'for item in list'">
                                                                    <div class="input-group input-group-sm">
                                                                        <span class="input-group-addon">item name</span>
                                                                        <input
                                                                            class="form-control"
                                                                            placeholder="{{node.itemName}}"
                                                                        name ="forItemName"
                                                                        ng-model="forItemName"
                                                                        ng-change="applyValue('forItemName',this.forItemName,node)">
                                                                    </div>

                                                                    <div class="input-group input-group-sm">
                                                                        <span class="input-group-addon"> List: </span>
                                                                        <select ng-model="forList"
                                                                                class="form-control"
                                                                                ng-change =
                                                                                        "applyValue('forList', this.forList,node)">
                                                                            <option value=""
                                                                                    selected disabled>
                                                                                {{node.forList}}
                                                                            </option>
                                                                            <option ng-repeat="node in data"
                                                                                    value="{{node.dataName}}">
                                                                                {{node.dataName}}
                                                                            </option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <!--dropdown menu for Action-->
                                                            <div ng-if="node.title == 'Action'">
                                                                <div class="input-group input-group-sm">
                                                                    <span class="input-group-addon"> method: </span>
                                                                        <select ng-model="method"
                                                                           name ="method"
                                                                           class="form-control"
                                                                           ng-change="applyValue('method',this.method,node)">
                                                                            <option value="" selected disabled>
                                                                                {{node.method}}
                                                                            </option>
                                                                            <option value="print data">print data</option>
                                                                            <option value="get input">get input </option>
                                                                            <option value="append output">append output</option>
                                                                    </select>
                                                                </div>
                                                            </div>

                                                            <!--method for append data to output port-->
                                                            <div ng-if="node.method == 'append output'">
                                                                <div class="input-group input-group-sm">
                                                                    <span class="input-group-addon"> output port: </span>
                                                                    <select ng-model="outputPort"
                                                                            class="form-control"
                                                                            ng-change =
                                                                                "applyValue('outputPort', this.outputPort,node)">
                                                                        <option value="" selected disabled>
                                                                            {{node.parameters[0]}}
                                                                        </option>
                                                                        <option  ng-repeat=
                                                                                 "outputPort in node.parentNode.outputConnectors"
                                                                                 value="{{outputPort.name}}">
                                                                            {{outputPort.name}}
                                                                        </option>
                                                                    </select>
                                                                </div>
                                                                <div class="input-group input-group-sm">
                                                                <span class="input-group-addon"> data name: </span>
                                                                    <select ng-model="outputDataName"
                                                                            class="form-control"
                                                                            ng-change =
                                                                                "applyValue('outputDataName', this.outputDataName,node)">
                                                                        <option value=""
                                                                                selected disabled>
                                                                            {{node.parameters[2]}}
                                                                        </option>
                                                                        <option ng-repeat="node in data"
                                                                                value="{{node.dataName}}">
                                                                            {{node.dataName}}
                                                                        </option>
                                                                    </select>
                                                                </div>
                                                            </div>

                                                            <!--method for get data from input port-->
                                                            <div ng-if="node.method == 'get input'">
                                                                <div class="input-group input-group-sm">
                                                                <span class="input-group-addon"> input port: </span>
                                                                    <select ng-model="inputPort"
                                                                            class="form-control"
                                                                            ng-change =
                                                                                    "applyValue('inputPort', this.inputPort,node)">
                                                                        <option value="" selected disabled>
                                                                            {{node.parameters[0]}}
                                                                        </option>
                                                                        <option  ng-repeat="inputPort in node.parentNode.inputConnectors"
                                                                                 value="{{inputPort.name}}">
                                                                            {{inputPort.name}}
                                                                        </option>
                                                                    </select>
                                                                </div>

                                                                <div class="input-group input-group-sm">
                                                                    <span class="input-group-addon">data name</span>
                                                                    <input class="form-control"
                                                                           name="dataName"
                                                                           placeholder="{{node.dataName}}"
                                                                           ng-model="dataName"
                                                                           ng-change=
                                                                                   "applyValue('dataName',this.dataName,node)">
                                                                </div>
                                                            </div>

                                                            <!--method for print data-->
                                                            <div ng-if="node.method == 'print data'">
                                                                <div class="input-group input-group-sm">
                                                                    <span class="input-group-addon"> data name: </span>
                                                                    <select ng-model="printDataName"
                                                                            class="form-control"
                                                                            ng-change =
                                                                                    "applyValue('printDataName', this.printDataName,node)">
                                                                        <option value=""
                                                                                selected disabled>
                                                                            {{node.parameters[1]}}
                                                                        </option>
                                                                        <option ng-repeat="node in data"
                                                                                value="{{node.dataName}}">
                                                                            {{node.dataName}}
                                                                        </option>
                                                                        <option ng-repeat="node in data"
                                                                                value="{{node.forItemName}}">
                                                                            {{node.forItemName}}
                                                                        </option>
                                                                    </select>
                                                                </div>
                                                            </div>

                                                            <div ng-repeat="node in node.nodes"
                                                                 ui-tree-node ng-include="'nodes_renderer_procedure.html'">
                                                            </div>
                                                        </div>
                                                    </accordion-group>
                                                </div>
                                            </accordion>
                                    </script>

                                    <div ui-tree id="tree-root">
                                        <div ui-tree-nodes="" ng-model="data">
                                            <div ng-repeat="node in data"
                                                 ui-tree-node ng-include="'nodes_renderer_procedure.html'">
                                            </div>
                                        </div>
                                    </div>

                                    </div>
                                </div>

                                <div class = "buttons">
                                    <br>
                                    <button class="btn btn-default btn-xs" ng-click="newItem('Data')">Add Data</button>
                                    &nbsp;&nbsp;&nbsp;
                                    <button class="btn btn-default btn-xs" ng-click="newItem('Action')">Add Action</button>
                                    &nbsp;&nbsp;&nbsp;
                                    <button class="btn btn-default btn-xs" ng-click="newItem('Control')">Add Control</button>
                                    &nbsp;&nbsp;&nbsp;
                                </div>
                        </tab>



                        <!--add to interface -->
                        <tab heading="Interface">
                                <script type="text/ng-template" id="nodes_renderer_interface.html">
                                    <div ui-tree-handle class="tree-node tree-node-content">
                                        <accordion>
                                            <accordion-group is-open="true">
                                                <accordion-heading>
                                                    <a ng-if="node.nodes && node.nodes.length > 0
                                                                || node.nodes && node.nodes.length == 0"
                                                       data-nodrag ng-click="toggle(this)">
                                                        <i class="glyphicon"
                                                           ng-class=
                                                                   "{'glyphicon-chevron-right': collapsed,
                                                                                     'glyphicon-chevron-down': !collapsed}">
                                                        </i>
                                                    </a>
                                                    {{node.title}}
                                                    <a class="pull-right btn btn-xs"
                                                       data-nodrag ng-click="remove(this)">
                                                                    <span class="glyphicon glyphicon-remove">
                                                                    </span>
                                                    </a>
                                                </accordion-heading>

                                                <div ui-tree-nodes=""
                                                     ng-model="node.nodes"
                                                     ng-class="{hidden: collapsed}">

                                                    <!--data name and value for interface data -->
                                                    <div ng-if="node.title == 'Data'">
                                                        <div class="input-group input-group-sm">
                                                            <span class="input-group-addon"> data name: </span>
                                                            <select ng-model="addToInterface"
                                                                    class="form-control"
                                                                    ng-change =
                                                                            "applyValue('addToInterface', this.addToInterface,node)">
                                                                <option value=""
                                                                        selected disabled>
                                                                    {{node.parameters[1]}}
                                                                </option>
                                                                <option ng-repeat="dataNode in data"
                                                                        value="{{dataNode.dataValue}},{{dataNode.dataName}},{{dataNode.id}}">
                                                                    {{dataNode.dataName}}
                                                                </option>
                                                            </select>
                                                        </div>

                                                        <div class="input-group input-group-sm">
                                                            <span class="input-group-addon" >data value</span>
                                                            <input class="form-control"
                                                                   name="interfaceValue"
                                                                   placeholder="{{node.parameters[0]}}"
                                                                   ng-model="interfaceValue"
                                                                   ng-change=
                                                                           "applyValue('interfaceValue',this.interfaceValue,node)">
                                                        </div>
                                                    </div>

                                                    <div ng-repeat="node in node.nodes"
                                                         ui-tree-node ng-include="'nodes_renderer_interface.html'">
                                                    </div>
                                                </div>
                                            </accordion-group>
                                        </div>
                                    </accordion>
                                </script>

                                <div ui-tree id="tree-root-1">
                                    <div ui-tree-nodes="" ng-model="interface">
                                        <div ng-repeat="node in interface"
                                             ui-tree-node ng-include="'nodes_renderer_interface.html'">
                                        </div>
                                    </div>
                                </div>

                            <div class="buttons">
                                <button class="btn btn-default btn-xs" ng-click="newInterface('Data')">Add Data</button>
                            </div>
                        </tab>

                        <!--ace text editor-->
                        <tab heading="Code">
                            <div class="codeEditor" ui-ace="{ mode: 'javascript', theme: 'monokai' }"
                                 ng-model="functionCode">
                            </div>
                        </tab>

                    </tabset>
                </div>

              </div>
            </div>
    </div>

     <!--jquery-->
     <script type="text/javascript" src="js/jquery/jquery-1.11.1.js"></script>
     <!--angular modules -->
     <script type="application/javascript" src="js/angular/angular.min.js"></script>
     <script type="text/javascript" src="js/angular/angular-sanitize.js"></script>
     <!--angular-ui packages-->
     <script type="text/javascript" src="js/angular-ui/ui-ace/ui-ace.js"></script>
     <script type="application/javascript" src="js/angular-ui/ui-layout/ui-layout.js"></script>
     <script src="js/angular-ui/ui-bootstrap/ui-bootstrap-tpls-0.11.0.min.js"></script>
     <script type="text/javascript" src="js/angular-ui/ui-tree/angular-ui-tree.js"></script>
     <!--supporting packages-->
     <script type="text/javascript" src="js/packages/select2-3.5.0/select2.js"></script>
     <script type="text/javascript" src="js/packages/ace-builds/src-min-noconflict/ace.js"></script>
     <!--flowchart system-->
     <script src="js/angular-ui/ui-flowchart/debug.js" type="text/javascript"></script>
     <script src="js/angular-ui/ui-flowchart/svg_class.js" type="text/javascript"></script>
     <script src="js/angular-ui/ui-flowchart/mouse_capture_service.js" type="text/javascript"></script>
     <script src="js/angular-ui/ui-flowchart/dragging_service.js" type="text/javascript"></script>
     <script src="js/angular-ui/ui-flowchart/flowchart_viewmodel.js" type="text/javascript"></script>
     <script src="js/angular-ui/ui-flowchart/flowchart_directive.js" type="text/javascript"></script>
      <!-- zoom and pan-->
     <script src="js/packages/hamsterjs/hamster.js"></script>
     <script src="js/angular/angular-mousewheel/mousewheel.js"></script>
     <script src="js/angular-ui/ui-panzoom/panzoom.js"></script>

     <!--vidamo angular app-->
     <script src="js/vidamo/vidamo.js"></script>
     <script src="js/vidamo/graph.js"></script>
     <script src="js/vidamo/panzoom.js"></script>
     <script src="js/vidamo/module.js"></script>
     <script src="js/vidamo/viewport.js"></script>

</body>

</html>