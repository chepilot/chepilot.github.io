/*!
 AngularJS pan/zoom v0.1-snapshot
 (c) 2014 Martin Vindahl Olsen
 License: MIT
 Github: https://github.com/mvindahl/angular-pan-zoom
*/
angular.module("panzoom",["monospaced.mousewheel"]).directive("panzoom",["$document",function(o){return{restrict:"E",transclude:!0,scope:{config:"=",model:"="},controller:["$scope","$element",function(e,n){var i=n,a=n.find(".pan-zoom-contents"),t=function(o){return Math.pow(e.config.scalePerZoomLevel,o-e.config.neutralZoomLevel)},l=function(o){return Math.log(o)/Math.log(e.config.scalePerZoomLevel)+e.config.neutralZoomLevel};e.config.zoomLevels=e.config.zoomLevels||5,e.config.neutralZoomLevel=e.config.neutralZoomLevel||2,e.config.friction=e.config.friction||10,e.config.haltSpeed=e.config.haltSpeed||100,e.config.scalePerZoomLevel=e.config.scalePerZoomLevel||2,e.config.zoomStepDuration=e.config.zoomStepDuration||.2,e.config.zoomStepDuration=e.config.zoomStepDuration||.2,e.config.modelChangedCallback=e.config.modelChangedCallback||function(){},e.config.zoomToFitZoomLevelFactor=e.config.zoomToFitZoomLevelFactor||.95,e.config.zoomButtonIncrement=e.config.zoomButtonIncrement||1,e.config.initialZoomLevel=e.config.initialZoomLevel||e.config.neutralZoomLevel,e.config.initialPanX=e.config.initialPanX||0,e.config.initialPanY=e.config.initialPanY||0,e.config.zoomOnDoubleClick=void 0!==e.config.zoomOnDoubleClick?e.config.zoomOnDoubleClick:!0,e.config.zoomOnMouseWheel=void 0!==e.config.zoomOnMouseWheel?e.config.zoomOnMouseWheel:!0,e.config.panOnClickDrag=void 0!==e.config.panOnClickDrag?e.config.panOnClickDrag:!0;var m=function(o){var i=n.width(),a=n.height(),m=o.width,c=o.height,r=Math.min(i/m,a/c),s=l(r),f=s*e.config.zoomToFitZoomLevelFactor,g=t(f);return{zoomLevel:f,pan:{x:-o.x*g+(i-m*g)/2,y:-o.y*g+(a-c*g)/2}}};e.base=e.config.initialZoomToFit?m(e.config.initialZoomToFit):{zoomLevel:e.config.initialZoomLevel,pan:{x:e.config.initialPanX,y:e.config.initialPanY}},e.model.zoomLevel=e.base.zoomLevel,e.model.pan={x:e.base.pan.x,y:e.base.pan.y},e.previousPosition=void 0,e.dragging=!1,e.panVelocity=void 0,e.zoomAnimation=void 0;var c=function(){if(e.zoomAnimation){e.model.zoomLevel=e.base.zoomLevel+e.zoomAnimation.deltaZoomLevel*e.zoomAnimation.progress;var o=e.zoomAnimation.translationFromZoom(e.model.zoomLevel);e.model.pan.x=e.base.pan.x+o.x,e.model.pan.y=e.base.pan.y+o.y}else e.model.zoomLevel=e.base.zoomLevel,e.model.pan.x=e.base.pan.x,e.model.pan.y=e.base.pan.y;var n="scale("+t(e.model.zoomLevel)+")";a.css("transform-origin","0 0"),a.css("ms-transform-origin","0 0"),a.css("webkit-transform-origin","0 0"),a.css("transform",n),a.css("ms-transform",n),a.css("webkit-transform",n),a.css("left",e.model.pan.x),a.css("top",e.model.pan.y)},r=function(){var o={x:i.width()/2,y:i.height()/2};return o},s=function(o,n){e.zoomAnimation&&(e.base.zoomLevel=e.model.zoomLevel,e.base.pan.x=e.model.pan.x,e.base.pan.y=e.model.pan.y,e.zoomAnimation=void 0),o=Math.max(0,o),o=Math.min(e.config.zoomLevels-1,o);var i=o-e.base.zoomLevel;if(i){var a=e.config.zoomStepDuration,l=n||r(),m=t(e.base.zoomLevel),c={x:e.base.pan.x,y:e.base.pan.y},s=function(o){var e=t(o),n={x:l.x-e/m*(l.x-c.x),y:l.y-e/m*(l.y-c.y)};return{x:n.x-c.x,y:n.y-c.y}};e.zoomAnimation={deltaZoomLevel:i,translationFromZoom:s,duration:a,progress:0}}};e.model.changeZoomLevel=s;var f=function(o){s(e.base.zoomLevel+e.config.zoomButtonIncrement,o)};e.model.zoomIn=f;var g=function(o){s(e.base.zoomLevel-e.config.zoomButtonIncrement,o)};e.model.zoomOut=g;var u=function(o){var n=o,i=t(e.base.zoomLevel),a=e.base.pan;return{x:n.x*i+a.x,y:n.y*i+a.y}};e.model.getViewPosition=u;var v=function(o){var n=o,i=t(e.base.zoomLevel),a=e.base.pan;return{x:1/i*(n.x-a.x),y:1/i*(n.y-a.y)}};e.model.getModelPosition=v;var p=function(o){e.base=m(o)};e.model.zoomToFit=p;var d=function(o){return Math.sqrt(o.x*o.x+o.y*o.y)},y=function(){var o=jQuery.now();return function(){var n=jQuery.now(),i=(n-o)/1e3;if(o=n,e.dragging)return!0;if(e.zoomAnimation&&(e.zoomAnimation.progress+=i/e.zoomAnimation.duration,e.zoomAnimation.progress>=1&&(e.zoomAnimation.progress=1,c(),e.base.zoomLevel=e.model.zoomLevel,e.base.pan.x=e.model.pan.x,e.base.pan.y=e.model.pan.y,e.zoomAnimation=void 0,e.config.modelChangedCallback(e.model))),e.panVelocity)for(;i>0;){var a=Math.min(.02,i);i-=a,e.base.pan.x+=e.panVelocity.x*a,e.panVelocity.x*=1-e.config.friction*a,e.base.pan.y+=e.panVelocity.y*a,e.panVelocity.y*=1-e.config.friction*a;var t=d(e.panVelocity);if(t<e.config.haltSpeed){e.panVelocity=void 0,e.config.modelChangedCallback(e.model);break}}return c(),!0}};c();var z=new y;jQuery.fx.timer(z),e.onDblClick=function(o){if(e.config.zoomOnDoubleClick){var n={x:o.pageX-i.offset().left,y:o.pageY-i.offset().top};f(n)}};var x,b;e.onMousedown=function(n){e.config.panOnClickDrag&&(b={x:n.pageX,y:n.pageY},x=jQuery.now(),e.dragging=!0,o.on("mousemove",e.onMousemove),o.on("mouseup",e.onMouseup))};var L=function(o){o.x=o.x||0,o.y=o.y||0,e.base.pan.x+=o.x,e.base.pan.y+=o.y,c()};e.model.pan=L,e.onMousemove=function(o){!e.dragging;var n=jQuery.now(),i=(n-x)/1e3;x=n;var a={x:o.pageX-b.x,y:o.pageY-b.y};L(a),e.panVelocity={x:a.x/i,y:a.y/i},b={x:o.pageX,y:o.pageY},o.preventDefault()},e.onMouseup=function(){var n=jQuery.now(),i=(n-x)/1e3;if(e.panVelocity){var a=Math.max(0,Math.pow(i+1,-4)-.2);e.panVelocity.x*=a,e.panVelocity.y*=a}e.dragging=!1,o.off("mousemove",e.onMousemove),o.off("mouseup",e.onMouseup)},e.onMouseleave=function(){e.onMouseup()},e.onMouseWheel=function(o,n,a,t){if(e.config.zoomOnMouseWheel){if(o.preventDefault(),e.zoomAnimation)return;var l=t/Math.abs(t),m={x:o.pageX-i.offset().left,y:o.pageY-i.offset().top};0>l?f(m):g(m)}}}],template:'<div class="pan-zoom-frame" ng-dblclick="onDblClick($event)" ng-mousedown="onMousedown($event)" msd-wheel="onMouseWheel($event, $delta, $deltaX, $deltaY)" style="position:relative;overflow:hidden;cursor:move"><div class="pan-zoom-contents" style="position:absolute;left:0px;top:0px" ng-transclude></div></div>',replace:!0}}]);
angular.module("panzoomwidget",[]).directive("panzoomwidget",["$document",function(o){return{restrict:"E",transclude:!0,scope:{config:"=",model:"="},controller:["$scope","$element",function(e,n){var i=n.find(".zoom-slider-widget"),t=!1,m=function(o){return(e.config.zoomLevels-o-1)*e.widgetConfig.zoomLevelHeight},l=function(o){return e.config.zoomLevels-1-o/e.widgetConfig.zoomLevelHeight},u=function(o){var i=o.pageY-n.find(".zoom-slider").offset().top-e.widgetConfig.zoomLevelHeight/2;return l(i)};e.getZoomLevels=function(){for(var o=[],n=e.config.zoomLevels-1;n>=0;n--)o.push(n);return o},e.widgetConfig={zoomLevelHeight:10},e.zoomIn=function(){e.model.zoomIn()},e.zoomOut=function(){e.model.zoomOut()},e.onClick=function(o){var n=u(o);e.model.changeZoomLevel(n)},e.onMousedown=function(){t=!0,o.on("mousemove",e.onMousemove),o.on("mouseup",e.onMouseup)},e.onMousemove=function(o){o.preventDefault();var n=u(o);e.model.changeZoomLevel(n)},e.onMouseup=function(){t=!1,o.off("mousemove",e.onMousemove),o.off("mouseup",e.onMouseup)},e.onMouseleave=function(){t=!1},setInterval(function(){i.css("top",m(e.model.zoomLevel)+"px")},25)}],template:'<div class="panzoomwidget"><div ng-click="zoomIn()" ng-mouseenter="zoomToLevelIfDragging(config.zoomLevels - 1)" class="zoom-button zoom-button-in">+</div><div class="zoom-slider" ng-mousedown="onMousedown()" ng-click="onClick($event)"><div class="zoom-slider-widget" style="height:{{widgetConfig.zoomLevelHeight - 2}}px"></div><div ng-repeat="zoomLevel in getZoomLevels()" " class="zoom-level zoom-level-{{zoomLevel}}" style="height:{{widgetConfig.zoomLevelHeight}}px"></div></div><div ng-click="zoomOut()" ng-mouseenter="zoomToLevelIfDragging(0)" class="zoom-button zoom-button-out">-</div><div ng-transclude></div></div>',replace:!0}}]);